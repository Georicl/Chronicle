---
// src/components/misc/BioBackground.astro
---

<canvas id="bio-canvas"></canvas>

<style>
  #bio-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 2;
    pointer-events: none;
    opacity: 0.8; /* ç¨å¾®è°ƒé«˜ä¸€ç‚¹ä¸é€æ˜åº¦ï¼Œè®©é¢œè‰²æ›´æ˜æ˜¾ */
  }
</style>

<script>
  const canvas = document.getElementById('bio-canvas') as HTMLCanvasElement;
  if (canvas) {
      const ctx = canvas.getContext('2d');
      let width = window.innerWidth;
      let height = window.innerHeight;
      
      canvas.width = width;
      canvas.height = height;

      // å®šä¹‰ç²’å­ç»“æ„ï¼Œå¢åŠ  color å±æ€§
      interface Particle {
        x: number;
        y: number;
        vx: number;
        vy: number;
        size: number;
        color: string; // æ¯ä¸ªç²’å­éƒ½æœ‰è‡ªå·±çš„é¢œè‰²
      }

      const particles: Particle[] = [];
      const config = {
        particleCount: 60,   // ç²’å­æ•°é‡
        connectDistance: 150, // è¿çº¿è·ç¦»
        speed: 0.5
      };

      function init() {
        particles.length = 0;
        for (let i = 0; i < config.particleCount; i++) {
          // ğŸ¨ éšæœºç”Ÿæˆé¢œè‰²é€»è¾‘
          // HSL: è‰²ç›¸(0-360), é¥±å’Œåº¦(70%-100%), äº®åº¦(60%-80%)
          const hue = Math.random() * 360; 
          const color = `hsla(${hue}, 80%, 70%, 0.8)`;

          particles.push({
            x: Math.random() * width,
            y: Math.random() * height,
            vx: (Math.random() - 0.5) * config.speed,
            vy: (Math.random() - 0.5) * config.speed,
            size: Math.random() * 2 + 1.5, // ç¨å¾®å¤§ä¸€ç‚¹ç‚¹
            color: color
          });
        }
      }

      function animate() {
        if (!ctx) return;
        ctx.clearRect(0, 0, width, height);
        
        for (let i = 0; i < particles.length; i++) {
          let p = particles[i];
          
          // ç§»åŠ¨
          p.x += p.vx;
          p.y += p.vy;

          // è¾¹ç•Œåå¼¹
          if (p.x < 0 || p.x > width) p.vx *= -1;
          if (p.y < 0 || p.y > height) p.vy *= -1;

          // ç»˜åˆ¶ç²’å­ (ä½¿ç”¨ç²’å­è‡ªå·±çš„é¢œè‰²)
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fillStyle = p.color;
          ctx.fill();

          // ç»˜åˆ¶è¿çº¿
          for (let j = i + 1; j < particles.length; j++) {
            let p2 = particles[j];
            let dx = p.x - p2.x;
            let dy = p.y - p2.y;
            let dist = Math.sqrt(dx*dx + dy*dy);

            if (dist < config.connectDistance) {
              // çº¿æ¡é€æ˜åº¦éšè·ç¦»å˜åŒ–
              const alpha = 1 - dist / config.connectDistance;
              ctx.beginPath();
              // çº¿æ¡é¢œè‰²ï¼šä¸ºäº†ä¸æ˜¾ä¹±ï¼Œå»ºè®®ä¿æŒç™½è‰²åŠé€æ˜ï¼Œæˆ–è€…ç”¨æµ…ç°è‰²
              ctx.strokeStyle = `rgba(255, 255, 255, ${alpha * 0.15})`; 
              ctx.lineWidth = 1;
              ctx.moveTo(p.x, p.y);
              ctx.lineTo(p2.x, p2.y);
              ctx.stroke();
            }
          }
        }
        requestAnimationFrame(animate);
      }

      // çª—å£å¤§å°æ”¹å˜æ—¶é‡ç½®
      window.addEventListener('resize', () => {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
        init();
      });

      init();
      animate();
  }
</script>